<!DOCTYPE html>
<html>
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Purple Admin</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="../../vendors/iconfonts/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="../../vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- inject:css -->
  <link rel="stylesheet" href="../../css/style.css">
  <!-- endinject -->
  <link rel="shortcut icon" href="../../images/favicon.png">
<style type="text/css">/* Chart.js */
@-webkit-keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}@keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}.chartjs-render-monitor{-webkit-animation:chartjs-render-animation 0.001s;animation:chartjs-render-animation 0.001s;}</style>
<!--  <script src="chrome-extension://ndkcpnnnlmhaccdogpecoblhkldojceg/assets/prompt.js"></script>   -->

</head>
<body>
	<div class="container-scroller">
    <!-- partial:../partials/_navbar.html -->
    <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo" href="index.html"><img src="../../images/logo.svg" alt="logo"></a>
        <a class="navbar-brand brand-logo-mini" href="index.html"><img src="../../images/logo-mini.svg" alt="logo"></a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-stretch">
        <!-- <div class="search-field d-none d-md-block">
          <form class="d-flex align-items-center h-100" action="#">
            <div class="input-group">
              <div class="input-group-prepend bg-transparent">
                  <i class="input-group-text border-0 mdi mdi-magnify"></i>                
              </div>
              <input type="text" class="form-control bg-transparent border-0" placeholder="Search projects">
            </div>
          </form>
        </div> -->
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item nav-profile dropdown">
            <a class="nav-link dropdown-toggle" id="profileDropdown" href="#" data-toggle="dropdown" aria-expanded="false">
              <div class="nav-profile-img">
                <img src="../../images/faces/face1.jpg" alt="image">
                <span class="availability-status online"></span>             
              </div>
              <div class="nav-profile-text">
                <p class="mb-1 text-black">David Greymaax</p>
              </div>
            </a>
            <div class="dropdown-menu navbar-dropdown" aria-labelledby="profileDropdown">
              <a class="dropdown-item" href="#">
                <i class="mdi mdi-lock-outline mr-2 text-primary"></i>
                修改密码
              </a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">
                <i class=" mdi mdi-image-filter-center-focus mr-2 text-primary"></i>
                人脸注册
              </a>
            </div>
          </li>
          <li class="nav-item d-none d-lg-block full-screen-link">
            <a class="nav-link">
              <i class="mdi mdi-fullscreen" id="fullscreen-button"></i>
            </a>
          </li>
           <li class="nav-item nav-logout d-none d-lg-block">
            <a class="nav-link" href="#">
              <i class="mdi mdi-power"></i>
            </a>
          </li>
        </ul>
        <!-- <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
          <span class="mdi mdi-menu"></span>
        </button> --> 
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:../partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <li class="nav-item nav-profile">
            <a href="#" class="nav-link">
              <div class="nav-profile-image">
                <img src="../../images/faces/face1.jpg" alt="profile">
                <span class="login-status online"></span> <!--change to offline or busy as needed-->              
              </div>
              <div class="nav-profile-text d-flex flex-column">
                <span class="font-weight-bold mb-2">David Grey. H</span>
                <span class="text-secondary text-small">Project Manager</span>
              </div>
<!--              <i class="mdi mdi-bookmark-check text-success nav-profile-badge"></i> -->
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link collapsed" data-toggle="collapse" href="#ui-basic1" aria-expanded="false" aria-controls="ui-basic1">
              <span class="menu-title">用户管理</span>
              <i class="menu-arrow"></i>
              <i class="mdi mdi-crosshairs-gps menu-icon"></i>
            </a>
            <div class="collapse" id="ui-basic1" style="">
              <ul class="nav flex-column sub-menu">
                <li class="nav-item"> <a class="nav-link" href="pages/ui-features/buttons.html">用户查询</a></li>
                <li class="nav-item"> <a class="nav-link" href="pages/addUser.html">添加用户</a></li>
              </ul>
            </div>
          </li>
        <li class="nav-item">
          <a class="nav-link collapsed" data-toggle="collapse" href="#ui-basic2" aria-expanded="false" aria-controls="ui-basic2">
            <span class="menu-title">部门管理</span>
            <i class="menu-arrow"></i>
            <i class="mdi mdi-crosshairs-gps menu-icon"></i>
          </a>
          <div class="collapse" id="ui-basic2" style="">
            <ul class="nav flex-column sub-menu">
              <li class="nav-item"> <a class="nav-link" href="pages/showAllDept.html">部门查询</a></li>
              <li class="nav-item"> <a class="nav-link" href="pages/addDept.html">添加部门</a></li>
            </ul>
          </div>
        </li>
		<li class="nav-item">
		  <a class="nav-link collapsed" data-toggle="collapse" href="#ui-basic3" aria-expanded="false" aria-controls="ui-basic3">
		    <span class="menu-title">职位管理</span>
		    <i class="menu-arrow"></i>
		    <i class="mdi mdi-crosshairs-gps menu-icon"></i>
		  </a>
		  <div class="collapse" id="ui-basic3" style="">
		    <ul class="nav flex-column sub-menu">
		      <li class="nav-item"> <a class="nav-link" href="pages/ui-features/buttons.html">职位查询</a></li>
		      <li class="nav-item"> <a class="nav-link" href="pages/ui-features/typography.html">添加职位</a></li>
		    </ul>
		  </div>
		</li>
		<li class="nav-item">
		  <a class="nav-link collapsed" data-toggle="collapse" href="#ui-basic4" aria-expanded="false" aria-controls="ui-basic4">
		    <span class="menu-title">公告管理</span>
		    <i class="menu-arrow"></i>
		    <i class="mdi mdi-crosshairs-gps menu-icon"></i>
		  </a>
		  <div class="collapse" id="ui-basic4" style="">
		    <ul class="nav flex-column sub-menu">
		      <li class="nav-item"> <a class="nav-link" href="pages/ui-features/buttons.html">公告查询</a></li>
		      <li class="nav-item"> <a class="nav-link" href="pages/ui-features/typography.html">添加公告</a></li>
		    </ul>
		  </div>
		</li>
       <li class="nav-item">
         <a class="nav-link collapsed" data-toggle="collapse" href="#ui-basic5" aria-expanded="false" aria-controls="ui-basic5">
           <span class="menu-title">下载中心</span>
           <i class="menu-arrow"></i>
           <i class="mdi mdi-crosshairs-gps menu-icon"></i>
         </a>
         <div class="collapse" id="ui-basic5" style="">
           <ul class="nav flex-column sub-menu">
             <li class="nav-item"> <a class="nav-link" href="pages/ui-features/buttons.html">文档查询</a></li>
             <li class="nav-item"> <a class="nav-link" href="pages/ui-features/typography.html">上传文档</a></li>
           </ul>
         </div>
       </li>
        </ul>
      </nav>
      <!-- partial -->
     <div class="main-panel">          
        <div class="content-wrapper">
          <div class="page-header">
            <h3 class="page-title">
                            部门管理
            </h3>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="pages/showAllDept.html">部门管理</a></li>
                <li class="breadcrumb-item active" aria-current="page">部门查询</li>
              </ol>
            </nav>
          </div>
          <div class="row">
            <div class="col-md-12 grid-margin stretch-card">
          <div class="card">
                <div class="card-body">
                  <h4 class="card-title">部门信息</h4>
                  
                  <form action="" method="post">
                  
                   <div class="col-md-5 ml-auto">
                  	<div class="form-group" >
                    <div class="input-group">
                      <input type="text" class="form-control" id="select_key" placeholder="请输入关键字" aria-label="请输入关键字" aria-describedby="basic-addon2">
                      <div class="input-group-append">
                        <button type="button" class="btn btn-sm btn-outline-primary" id="select_dept">搜索</button>&nbsp;&nbsp;&nbsp;
                        <button type="button" class="btn btn-sm btn-outline-danger" id="batchDelete_dept">批量删除</button>
                      </div>
                    </div>
                  </div>
                  </div>
                  </form>
                  
                  <table class="table table-striped">
                    <thead style='text-align: center;'>
                      <tr>
                  						<th style="width: 10%;">
                  							<label class="form-check-label">
                              <input type="checkbox" class="form-check-input" id="checkAll">
                            <i class="input-helper"></i></label>
                  						</th>
                        <th style="width: 25%;">部门名称</th>
                        <th style="width: 45%;">详细信息</th>
                        <th style="width: 20%;">操作</th>
                      </tr>
                    </thead>
                    <tbody id="tbodyId" style='text-align: center;'>
                      
                    </tbody>
                  </table>
                </div>
              </div>
             </div>
           </div>  
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:../../partials/_footer.html -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Copyright © 2017 <a href="#" target="_blank">Bootstrap Dash</a>. All rights reserved.</span>
           </div>
        </footer>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
	<!-- container-scroller -->
  
	<!-- 修改部门信息表格 -->
	<div class="box box-info" id="dept_modify_table" style="display: none">
		
		<div class="row">
            <div class="col-md-12 grid-margin stretch-card">
				<div class="card">
					<div class="card-body">
						
						
						<form class="forms-sample">
							<div class="form-group">
								<label for="new_dept_name">部门名称</label>
								<input type="text" class="form-control" id="new_dept_name" name="newDeptname" placeholder="部门名称">
							</div>
                    
							<div class="form-group">
								<label for="new_dept_desc">详细描述</label>
								<textarea class="form-control" id="new_dept_desc" rows="10"></textarea>
							</div>
                    
							<button type="button" class="btn btn-gradient-primary mr-2" id="dept_update_sumbit">提交</button>
							<button type="button" class="btn btn-light" id="dept_update_cancel">取消</button>
						</form>
				  
				  
					</div>
				</div>
            </div>       
        </div>
  
	

  </div>
  
  
  
  <!-- plugins:js -->
  <script src="../../vendors/js/vendor.bundle.base.js"></script>
  <script src="../../vendors/js/vendor.bundle.addons.js"></script>
  <!-- endinject -->
  <!-- inject:js -->
  <script src="../../js/off-canvas.js"></script>
  <script src="../../js/misc.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="../../js/file-upload.js"></script>
  <!-- End custom js for this page-->
  <script src="../../layer/layer.js"></script>
<script>
    $(function(){
		var select_key = localStorage.getItem("select_key");//接收上一个搜索页面传过来的值
		var dataSend = {
		    select_key:select_key
		
		};
		console.log(dataSend);
        $.ajax({
            type: "POST",
            url: 'http://localhost:8080/new_ssm/dept/selectDeptResult',//请求controller方法   
            data: JSON.stringify(dataSend),
			contentType: "application/json; charset=utf-8",
            dataType: "json",
            async: false, //同步请求，注意此字段    
            success: function (data) {
                if(data.error_code == 0){
                    var $tbody = $("#tbodyId");
                    var dl = data.data;
                    console.log(dl);
                    $.each(dl,function (i,e) {
						var $checkBox=document.createElement("input");
						$checkBox.setAttribute("type","checkbox");
						$checkBox.setAttribute("class","box_");
						
						var $tdbox =$("<td>").append($checkBox);
                        var $tr = $("<tr>")
							.append($tdbox)
                            .append($("<td>").html(e["departmentName"]))
                            .append($("<td>").html(e["departmentMessage"]))
                            
                        var $button_1 = document.createElement("a");
                        $button_1.text = "修改";
                        //$button_1.className = "btn btn-xs btn-info";
                        $button_1.className = "btn btn-xs btn-inverse-primary";
                        var $button_2 = document.createElement("a");
                        $button_2.text = "删除";
                        $button_2.className = "btn btn-xs btn-inverse-danger";
                        var $td = $("<td>").append($button_1).append($button_2);
                        $tr.append($td);
                        $tbody.append($tr);

                    });
                }else{

                    layer.alert("数据请求失败！");
                }
            }
        });
    })
</script>

<script type="text/javascript">
        $(function(){
            /**为全选绑定点击事件实现全选全不选*/
            $("#checkAll").click(function(){
                
				var isChecked=this.checked;
                $("input[class='box_']").each(function(){
					this.checked=isChecked;
				});
                
				
            });
			/**还需要为每一个子checkbox绑定事件，
			当下面的子checkbox全部都选中的时候，上面的全选按扭也应该要选中
			当下面的子checkbox出现未选中的时候，上面的全选按扭也应该取消选中*/
			$("input[class='box_']").click(function(){
			if(!$(".box_").checked){
				$("#checkAll").prop("checked",false); // 子复选框某个不选择，全选也被取消
			}
			var choicelength=$("input[class='box_']").length;
			var choiceselect=$("input[class='box_']:checked").length;
 
			if(choicelength==choiceselect){
				$("#checkAll").prop("checked",true);   // 子复选框全部部被选择，全选也被选择；1.对于HTML元素我们自己自定义的DOM属性，在处理时，使用attr方法；2.对于HTML元素本身就带有的固有属性，在处理时，使用prop方法。
			}
			});

        });
</script>



<script>
    $(function () {
            
		$(".content-wrapper").on("click", ".btn-inverse-danger", function () {
			var $tr = $(this).parents("tr");
			var dept_name = $tr.find("td:eq(1)").html();
			var deptnames = new Array();
			deptnames.push(dept_name);
			var dataSend = {
			    dept_name: deptnames
			
			};
            console.log(dataSend);
			
            layer.confirm('确定删除部门'+'"'+dept_name+'"?', {icon: 3, title:'提示'}, function(index){
				$.ajax({
                   	type: "POST",
                   	url: 'http://localhost:8080/new_ssm/dept/deleteDept',
                   	data: JSON.stringify(dataSend),
                   	contentType: "application/json; charset=utf-8",
                   	dataType: "json",
                   	async: false,
                   	success: function (data) {
                       	if(data.error_code == 0){
                           	layer.alert('删除成功', { icon: 1, closeBtn: 0 }, function (index) {
                               	layer.closeAll();
								window.location.reload();
                          	});

                       	}else{
                           	layer.alert('删除失败', { icon: 2, closeBtn: 0 });
                       	}
                   	},
                   	error:function(data){
                   		layer.alert(data.message, { icon: 2, closeBtn: 0 });
                   	}
               	});
               	layer.close(index);
               
            });
		});
		
		//批量删除
		$(".content-wrapper").on("click", ".btn-outline-danger", function () {
			var choiceselect=$("input[class='box_']:checked").length;
			if (choiceselect == 0) {
				layer.msg('请选择需要批量删除的部门！', {
					  icon: 2,
					  time: 2000 //2秒关闭（如果不配置，默认是3秒）
					});
				
			} else{
		    layer.confirm('确定删除吗?', {icon: 3, title:'提示'}, function(index){
				var checkboxs = $("input[class='box_']");
				var deptnames = new Array();
				checkboxs.each(function () {
					if($(this).prop("checked")){
					var $tr = $(this).parents("tr");
					var dept_name = $tr.find("td:eq(1)").html();
					deptnames.push(dept_name);
					}
				})
				var dataSend = {
			    dept_name: deptnames
			
				};
				console.log(dataSend);
				$.ajax({
		           	type: "POST",
		           	url: 'http://localhost:8080/new_ssm/dept/deleteDept',
		           	data: JSON.stringify(dataSend),
		           	contentType: "application/json; charset=utf-8",
		           	dataType: "json",
		           	async: false,
		           	success: function (data) {
		               	if(data.error_code == 0){
		                   	layer.alert('删除成功', { icon: 1, closeBtn: 0 }, function (index) {
		                       	layer.closeAll();
								window.location.reload();
		                  	});
		
		               	}else{
		                   	layer.alert('删除失败', { icon: 2, closeBtn: 0 });
		               	}
		           	},
		           	error:function(data){
		           		layer.alert(data.message, { icon: 2, closeBtn: 0 });
		           	}
		       	});
		       	layer.close(index);
		       
		    });
			}
		});
		
		
		// 修改部门信息
		$(".content-wrapper").on("click", ".btn-inverse-primary", function () {
			var $tr = $(this).parents("tr");
			
			var dept_name = $tr.find("td:eq(1)").html();
			var dept_desc = $tr.find("td:eq(2)").html();
			$("#new_dept_desc").val(dept_desc);
		    layer.open({
		        type: 1,
		        title: '修改部门信息',
		        shadeClose: true,
		        shade: 0.5,
		        area: ['500px', '600px'],
		        content: $("#dept_modify_table")
		    })
		
		    $("#new_dept_name").attr("value", $tr.find("td:eq(1)").html());
		    $("#new_dept_desc").attr("value", $tr.find("td:eq(2)").html());
		    
		
		    $("#dept_update_sumbit").click(function(){
		        var dataSend = [
		            {
		                
		                dept_name: dept_name,
						new_dept_name:$("#new_dept_name").val(),
						new_dept_desc:$("#new_dept_desc").val()
		            }
		    ];
		
		        console.log(dataSend);
				if ($.trim($("#new_dept_name").val()) == "") {
					layer.msg('部门名称不能为空！', {
						  icon: 2,
						  time: 2000 //2秒关闭（如果不配置，默认是3秒）
						}); 
				} else if ($.trim($("#new_dept_desc").val()) == "") {
					layer.msg('部门描述不能为空！', {
				  		  icon: 2,
				  		  time: 2000 //2秒关闭（如果不配置，默认是3秒）
				  		});
				}else if ($.trim($("#new_dept_desc").val()).length > 255) {
				layer.msg('详细描述限制输入255个字符！', {
	          		  icon: 2,
	          		  time: 2000 //2秒关闭（如果不配置，默认是3秒）
	          		});
				}else{
		        $.ajax({
		            type: "POST",
		            url: 'http://localhost:8080/new_ssm/dept/updateDept',
		            data: JSON.stringify(dataSend),
		            contentType: "application/json; charset=utf-8",
		            dataType: "json",
		            async: false,
		            success: function (data) {
		                if(data.error_code == 0){
		                    layer.alert('修改成功！', { icon: 1, closeBtn: 0 }, function (index) {
                               		layer.closeAll();
									window.location.reload();
                          	 });
		
		                }else{
		                    layer.alert('修改失败！', { icon: 2, closeBtn: 0 });
		                }
		            }
		        });
				}
		
		    });
		
		
		});
		$("#dept_update_cancel").click(function(){
		    layer.closeAll();
		});
		//查询
		$("#select_dept").click(function(){
			var select_key = $("#select_key").val();
			if (window.localStorage) {
			localStorage.setItem("select_key", $('#select_key').val());
			} else {
			Cookie.write("select_key", $('#select_key').val());
			}
			
					
			var dataSend = {
					select_key:select_key
			};
			console.log(dataSend);
		    if ($.trim(select_key) == "") {
		    	layer.msg('请输入关键字！', {
		    		  icon: 2,
		    		  time: 2000 //2秒关闭（如果不配置，默认是3秒）
		    		}); 
			}else{
				
				$.ajax({
		           		type: "POST",
		           		url: 'http://localhost:8080/new_ssm/dept/selectDeptResult',
		           		data: JSON.stringify(dataSend),
		           		contentType: "application/json; charset=utf-8",
		           		dataType: "json",
		           		async: false,
		           		success: function (data) {
		               		if(data.error_code == 0){
		                   		window.location.href = 'selectDeptResult.html?search='+$("#select_key").val();
                
		               		}
		               		else if(data.error_code == 2){
		                   		layer.alert('未查询到该部门', { icon: 2, closeBtn: 0 });
		               		}else{
		                   		layer.alert('查询失败，请重试！', { icon: 2, closeBtn: 0 });
		               		}
		           		},
		           		error:function(data){
		           			layer.alert('查询失败，请重试！', { icon: 2, closeBtn: 0 });
		           		}
		       		});
		       		layer.close(index);
		       
		    	
				}
		   
		});
           
	})
    
</script>
</body>
</html>